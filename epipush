#!/usr/bin/env ruby

`git --version > /dev/null 2>&1`

if $? != 0
    puts 'Git is not installed'
    exit 1
end

@emoji = {
    'add' => 'ðŸŽ‰',
    'fix' => 'ðŸ›',
    'improve' => 'âœ¨',
    'document' => 'ðŸ“š',
    'optimize' => 'ðŸš€',
    'configure' => 'ðŸ”§',
    'merge' => 'ðŸ”€',
    'remove' => 'ðŸ—‘ï¸',
    'refactor' => 'âš¡',
    'working' => 'ðŸš§',
    'move' => 'ðŸšš',
    'update' => 'ðŸ”„ï¸',
    'security' => 'ðŸ”’',
    'quality' => 'ðŸ‘Œ',
    'version' => 'ðŸ”–',
    'warning' => 'ðŸš¨',
    'release' => 'ðŸ“¦',
    'test' => 'ðŸ”'
}

if ARGV[0] == 'list'
    puts "ðŸŽ‰ Add: When adding a new feature or file.
    \rðŸ› Fix: When fixing a bug.
    \râœ¨ Improve: When improving an existing feature.
    \rðŸ“š Document: When adding or updating documentation.
    \rðŸš€ Optimize: When optimizing performance.
    \rðŸ”§ Configure: When configuring or updating configuration.
    \rðŸ”€ Merge: When merging branches or resolving conflicts.
    \rðŸ”¥ Remove: When removing code or files.
    \râš¡ï¸ Refactor: When improving code without adding features.
    \rðŸš§ Work in Progress: When there is ongoing work that is not yet completed.
    \rðŸšš Move: When moving files or directories.
    \rðŸ”„ Update: When updating dependencies, packages, or versions.
    \rðŸ”’ Security: When improving security.
    \rðŸ‘Œ Quality Improvement: When improving code quality.
    \rðŸ”– Version: When creating or updating version tags.
    \rðŸš¨ Warning: When fixing issues or warnings.
    \rðŸš‘ Critical Fix: When fixing a critical issue.
    \rðŸ“¦ Release: When publishing or preparing for a new release.
    \rðŸ” Test: When adding, modifying, or running tests."
    exit
elsif ARGV[0] == '-h'
    puts "USAGE\n\tepipush [type] [message] [files]\n
    \rDESCRIPTION
    \r\tType\tType of commit. Use 'epipush list' to see all types.
    \r\tMessage\tCommit message.
    \r\tFiles\tFiles to commit."
    exit
end

type, message, *files = ARGV

if type.nil?
    puts 'Please enter a commit type'
    exit 1
end

if !@emoji.key?(type.downcase)
    puts 'Please enter a valid commit type'
    exit 1
end

if message.nil?
    puts 'Please enter a commit message'
    exit 1
end

if files.empty?
    puts 'Please enter files'
    exit 1
end

`git add #{files.join(' ')} > /dev/null 2>&1`

if $? == 0
    puts "Added #{files.join(', ')}"
else
    puts 'Something went wrong...'
    exit 1
end

`git commit -m "#{@emoji[type.downcase]} #{type.capitalize}: #{message}" > /dev/null 2>&1`

if $? == 0
    puts 'Committed'
else
    puts 'Something went wrong...'
    exit 1
end

`git push > /dev/null 2>&1`

if $? == 0
    puts 'Pushed'
else
    puts 'Something went wrong...'
    exit 1
end